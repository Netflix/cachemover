app-type: debian-package
jenkins-master: merch
jenkins-default-job: evcache-native-dumper

package-name: evcache-native-dumper
package-requires:
  # check if pistache can be added here as opposed to pulling it into the repo
package-version: "1.0"

build-image: dockerregistry.test.netflix.net:7002/engtools/newt-common-builder/bionic:latest

build-setup:
  - sudo apt-get update
  - sudo apt-get install -y cmake g++ libcurl4-openssl-dev rapidjson-dev libssl-dev uuid-dev zlib1g-dev libpulse-dev
  - CWD=$(pwd)
  - cd ./extern/ && git clone --branch 1.7.332 https://github.com/aws/aws-sdk-cpp.git && mkdir -p aws-sdk-cpp/build && cd aws-sdk-cpp/build && cmake -DBUILD_ONLY="s3" -DAUTORUN_UNIT_TESTS=OFF -DBUILD_SHARED_LIBS=OFF .. && sudo make && sudo make install && cd $CWD
build-steps:
  - rm -rf ./build/
  - mkdir -p ./build/
  - cd ./build/ && cmake .. && make && cp ../bin/memcache-dumper ../root/apps/memcache-native-dumper/.

#package-postinstall-file: scripts/postinstall.sh
